{"version":3,"file":"index.js","mappings":";;;;;;;;;;;;;AAAO,IAAM,WAAW,GAAG,UAAC,MAAkB;IAC5C,IAAM,IAAI,GAAG,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;IAC9D,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACpC,IAAI,MAAM,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,CAAC,EAAE;YACzB,OAAO,KAAK,CAAC;SACd;KACF;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AARW,mBAAW,eAQtB;AAEK,IAAM,kBAAkB,GAAG,UAChC,MAAkB;;IAElB,IAAM,KAAK,GAAgC,EAAE,CAAC;IAC9C,IAAI,GAAG,GAAG,IAAI,CAAC;IACf,IAAI,KAAK,GAAuC,QAAQ,CAAC;IACzD,IAAI,IAAI,GAAG,EAAE,CAAC;IACd,IAAI,MAAM,GAAG,CAAC,CAAC;IACf,OAAO,IAAI,EAAE;QACX,IAAI,KAAK,KAAK,QAAQ,EAAE;YACtB,MAAM,GAAG,IAAI,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,SAAS,CAChE,CAAC,EACD,KAAK,CACN,CAAC;YACF,GAAG,IAAI,CAAC,CAAC;YACT,KAAK,GAAG,MAAM,CAAC;SAChB;aAAM,IAAI,KAAK,KAAK,MAAM,EAAE;YAC3B,IAAI,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;YAC/D,GAAG,IAAI,CAAC,CAAC;YACT,IACE,IAAI,KAAK,MAAM;gBACf,IAAI,KAAK,MAAM;gBACf,IAAI,KAAK,MAAM;gBACf,IAAI,KAAK,MAAM;gBACf,IAAI,KAAK,MAAM,EACf;gBACA,KAAK,GAAG,MAAM,CAAC;aAChB;iBAAM;gBACL,MAAM;aACP;SACF;aAAM,IAAI,KAAK,KAAK,MAAM,EAAE;YAC3B,IAAI,IAAI,KAAK,MAAM,EAAE;gBACnB,IAAM,UAAU,GAAG,GAAG,CAAC;gBACvB,IAAM,SAAS,GAAG,UAAU,GAAG,MAAM,CAAC;gBACtC,OAAO,GAAG,GAAG,SAAS,EAAE;oBACtB,GAAG,IAAI,CAAC,CAAC;oBACT,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;wBACrB,MAAM;qBACP;iBACF;gBACD,IAAM,GAAG,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,CAAC;gBACvE,GAAG,IAAI,CAAC,CAAC;gBACT,IAAM,KAAK,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;gBACxE,GAAG,GAAG,SAAS,CAAC;gBAChB,KAAK,CAAC,IAAI,WAAG,GAAC,GAAG,IAAG,KAAK,MAAG,CAAC;aAC9B;iBAAM,IAAI,IAAI,KAAK,MAAM,EAAE;gBAC1B,IAAM,UAAU,GAAG,GAAG,CAAC;gBACvB,IAAM,SAAS,GAAG,UAAU,GAAG,MAAM,CAAC;gBACtC,OAAO,GAAG,GAAG,SAAS,EAAE;oBACtB,GAAG,IAAI,CAAC,CAAC;oBACT,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;wBACrB,MAAM;qBACP;iBACF;gBACD,IAAM,GAAG,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,CAAC;gBACvE,GAAG,IAAI,CAAC,CAAC;gBACT,OAAO,GAAG,GAAG,SAAS,EAAE;oBACtB,GAAG,IAAI,CAAC,CAAC;oBACT,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;wBACrB,MAAM;qBACP;iBACF;gBACD,OAAO,GAAG,GAAG,SAAS,EAAE;oBACtB,GAAG,IAAI,CAAC,CAAC;oBACT,IAAI,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;wBACrB,MAAM;qBACP;iBACF;gBAED,GAAG,IAAI,CAAC,CAAC;gBACT,IAAM,KAAK,GAAG,IAAI,WAAW,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC;gBACxE,GAAG,GAAG,SAAS,CAAC;gBAChB,KAAK,CAAC,IAAI,WAAG,GAAC,GAAG,IAAG,KAAK,MAAG,CAAC;aAC9B;iBAAM;gBACL,GAAG,IAAI,MAAM,CAAC;aACf;YACD,KAAK,GAAG,KAAK,CAAC;SACf;aAAM,IAAI,KAAK,KAAK,KAAK,EAAE;YAC1B,GAAG,IAAI,CAAC,CAAC;YACT,KAAK,GAAG,QAAQ,CAAC;SAClB;QACD,IAAI,GAAG,IAAI,MAAM,CAAC,MAAM,EAAE;YACxB,MAAM;SACP;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC,CAAC;AAtFW,0BAAkB,sBAsF7B;AAEK,IAAM,cAAc,GAAG,UAAC,KAAe;IAC5C,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;QACpB,OAAO,KAAK,CAAC;KACd;IACD,IAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IACtB,IAAI,IAAI,KAAK,SAAS,EAAE;QACtB,OAAO,KAAK,CAAC;KACd;IACD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE;QAC3C,OAAO,KAAK,CAAC;KACd;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AAZW,sBAAc,kBAYzB;AAEK,IAAM,oBAAoB,GAAG,UAAC,KAAe;IAClD,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;QACtB,OAAO,KAAK,CAAC;KACd;IACD,IAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IACtB,IAAI,IAAI,KAAK,SAAS,EAAE;QACtB,OAAO,KAAK,CAAC;KACd;IACD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,EAAE;QAClC,OAAO,KAAK,CAAC;KACd;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AAZW,4BAAoB,wBAY/B;;;;;;;UC5HF;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;;;;ACtBA,oEAAwD;AAExD,IAAM,aAAa,GAAG,QAAQ,CAAC,cAAc,CAAC,eAAe,CAAE,CAAC;AAChE,IAAM,MAAM,GAAG,QAAQ,CAAC,cAAc,CAAC,QAAQ,CAAE,CAAC;AAElD,IAAM,cAAc,GAAG,UAAC,KAAe;IACrC,IAAM,IAAI,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC;IACtB,IAAI,IAAI,KAAK,SAAS,EAAE;QACtB,OAAO;KACR;IACD,IAAM,MAAM,GAAG,IAAI,UAAU,EAAE,CAAC;IAChC,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;IAC/B,MAAM,CAAC,MAAM,GAAG;QACd,IAAM,GAAG,GAAG,IAAI,UAAU,CAAC,MAAM,CAAC,MAAqB,CAAC,CAAC;QACzD,IAAI,CAAC,qBAAW,EAAC,GAAG,CAAC,EAAE;YACrB,OAAO;SACR;QACD,IAAM,KAAK,GAAG,4BAAkB,EAAC,GAAG,CAAC,CAAC;QACtC,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;IAC7C,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,aAAa,CAAC,gBAAgB,CAC5B,QAAQ,EACR,UAAU,CAAC;IACT,CAAC,CAAC,cAAc,EAAE,CAAC;IACnB,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE;QACb,OAAO;KACR;IACD,IAAM,KAAK,GAAI,CAAC,CAAC,MAA2B,CAAC,KAAM,CAAC;IACpD,cAAc,CAAC,KAAK,CAAC,CAAC;AACxB,CAAC,EACD,KAAK,CACN,CAAC;AAEF,QAAQ,CAAC,gBAAgB,CAAC,UAAU,EAAE,UAAU,CAAC;IAC/C,CAAC,CAAC,cAAc,EAAE,CAAC;AACrB,CAAC,CAAC,CAAC;AAEH,QAAQ,CAAC,gBAAgB,CAAC,MAAM,EAAE,UAAU,CAAC;IAC3C,CAAC,CAAC,cAAc,EAAE,CAAC;IACnB,IAAI,CAAC,CAAC,CAAC,YAAY,EAAE;QACnB,OAAO;KACR;IACD,cAAc,CAAC,CAAC,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;AACvC,CAAC,CAAC,CAAC","sources":["webpack://pngdecoder/./client/src/png.ts","webpack://pngdecoder/webpack/bootstrap","webpack://pngdecoder/./client/src/index.ts"],"sourcesContent":["export const isBufferPng = (buffer: Uint8Array): boolean => {\r\n  const sign = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\r\n  for (let i = 0; i < sign.length; i++) {\r\n    if (buffer[i] !== sign[i]) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const getTextsFromBuffer = (\r\n  buffer: Uint8Array,\r\n): { [key: string]: string }[] => {\r\n  const texts: { [key: string]: string }[] = [];\r\n  let cur = 0x21;\r\n  let state: \"length\" | \"type\" | \"data\" | \"CRC\" = \"length\";\r\n  let type = \"\";\r\n  let length = 0;\r\n  while (true) {\r\n    if (state === \"length\") {\r\n      length = new DataView(buffer.slice(cur, cur + 4).buffer).getUint32(\r\n        0,\r\n        false,\r\n      );\r\n      cur += 4;\r\n      state = \"type\";\r\n    } else if (state === \"type\") {\r\n      type = new TextDecoder().decode(buffer.subarray(cur, cur + 4));\r\n      cur += 4;\r\n      if (\r\n        type === \"tEXt\" ||\r\n        type === \"sRGB\" ||\r\n        type === \"pHYs\" ||\r\n        type === \"gAMA\" ||\r\n        type === \"iTXt\"\r\n      ) {\r\n        state = \"data\";\r\n      } else {\r\n        break;\r\n      }\r\n    } else if (state === \"data\") {\r\n      if (type === \"tEXt\") {\r\n        const initialCur = cur;\r\n        const finishCur = initialCur + length;\r\n        while (cur < finishCur) {\r\n          cur += 1;\r\n          if (buffer[cur] === 0) {\r\n            break;\r\n          }\r\n        }\r\n        const key = new TextDecoder().decode(buffer.subarray(initialCur, cur));\r\n        cur += 1;\r\n        const value = new TextDecoder().decode(buffer.subarray(cur, finishCur));\r\n        cur = finishCur;\r\n        texts.push({ [key]: value });\r\n      } else if (type === \"iTXt\") {\r\n        const initialCur = cur;\r\n        const finishCur = initialCur + length;\r\n        while (cur < finishCur) {\r\n          cur += 1;\r\n          if (buffer[cur] === 0) {\r\n            break;\r\n          }\r\n        }\r\n        const key = new TextDecoder().decode(buffer.subarray(initialCur, cur));\r\n        cur += 2;\r\n        while (cur < finishCur) {\r\n          cur += 1;\r\n          if (buffer[cur] === 0) {\r\n            break;\r\n          }\r\n        }\r\n        while (cur < finishCur) {\r\n          cur += 1;\r\n          if (buffer[cur] === 0) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        cur += 1;\r\n        const value = new TextDecoder().decode(buffer.subarray(cur, finishCur));\r\n        cur = finishCur;\r\n        texts.push({ [key]: value });\r\n      } else {\r\n        cur += length;\r\n      }\r\n      state = \"CRC\";\r\n    } else if (state === \"CRC\") {\r\n      cur += 4;\r\n      state = \"length\";\r\n    }\r\n    if (cur >= buffer.length) {\r\n      break;\r\n    }\r\n  }\r\n  return texts;\r\n};\r\n\r\nexport const isNovelAiTexts = (texts: string[]): boolean => {\r\n  if (texts.length < 5) {\r\n    return false;\r\n  }\r\n  const text = texts[2];\r\n  if (text === undefined) {\r\n    return false;\r\n  }\r\n  if (!text.startsWith(\"Software\\x00NovelAI\")) {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const isAutomatic1111Texts = (texts: string[]): boolean => {\r\n  if (texts.length !== 1) {\r\n    return false;\r\n  }\r\n  const text = texts[0];\r\n  if (text === undefined) {\r\n    return false;\r\n  }\r\n  if (!text.startsWith(\"parameters\")) {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { isBufferPng, getTextsFromBuffer } from \"./png\";\r\n\r\nconst button_upload = document.getElementById(\"button_upload\")!;\r\nconst result = document.getElementById(\"result\")!;\r\n\r\nconst onFileSelected = (files: FileList) => {\r\n  const file = files[0];\r\n  if (file === undefined) {\r\n    return;\r\n  }\r\n  const reader = new FileReader();\r\n  reader.readAsArrayBuffer(file);\r\n  reader.onload = () => {\r\n    const arr = new Uint8Array(reader.result as ArrayBuffer);\r\n    if (!isBufferPng(arr)) {\r\n      return;\r\n    }\r\n    const texts = getTextsFromBuffer(arr);\r\n    result.textContent = JSON.stringify(texts);\r\n  };\r\n};\r\n\r\nbutton_upload.addEventListener(\r\n  \"change\",\r\n  function (e) {\r\n    e.preventDefault();\r\n    if (!e.target) {\r\n      return;\r\n    }\r\n    const files = (e.target as HTMLInputElement).files!;\r\n    onFileSelected(files);\r\n  },\r\n  false,\r\n);\r\n\r\ndocument.addEventListener(\"dragover\", function (e) {\r\n  e.preventDefault();\r\n});\r\n\r\ndocument.addEventListener(\"drop\", function (e) {\r\n  e.preventDefault();\r\n  if (!e.dataTransfer) {\r\n    return;\r\n  }\r\n  onFileSelected(e.dataTransfer.files);\r\n});\r\n"],"names":[],"sourceRoot":""}